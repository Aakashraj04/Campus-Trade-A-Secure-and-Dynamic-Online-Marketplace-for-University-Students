<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Campus Trade - Campus. Click. Connect.</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #000;
      color: #fff;
      overflow-x: hidden;
    }
    .hero-title {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #fff, #ccc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .cta-button {
      background: linear-gradient(135deg, #d4af37, #f4e4bc);
      color: #000;
      transition: all 0.3s ease;
    }
    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(212, 175, 55, 0.3);
    }
    .category-chip:hover {
      transform: scale(1.05);
    }
    #navbar {
      transform: translateY(0);
      transition: transform 0.5s ease-in-out;
    }
    /* Horizontal scroll snapping for items */
    #featured-items {
      scroll-snap-type: x mandatory;
    }
    .item-card {
      scroll-snap-align: start;
    }
  </style>
</head>
<body class="min-h-screen">

  <!-- üß≠ Sticky Top Navigation -->
<nav id="navbar" class="fixed top-0 left-0 right-0 z-50 backdrop-blur-md bg-black/60 shadow-md transition-all duration-500">
  <div class="flex justify-between items-center px-6 py-4">
    <div class="text-2xl font-bold bg-gradient-to-r from-yellow-400 to-yellow-200 text-transparent bg-clip-text">
      Campus Trade
    </div>
    <div class="flex gap-4 items-center">

  <!-- Login / Signup button (kept for fallback) -->
  <button id="authBtn"
    class="px-4 py-2 rounded-md border border-white hover:bg-white hover:text-black transition">
    Login/Sign up
  </button>

  <!-- ‚úÖ Profile Section -->
  <div id="profileSection" class="hidden relative">
    <button id="profileBtn"
      class="flex items-center gap-2 px-3 py-2 rounded-full border border-white hover:bg-white hover:text-black transition">
      <img id="profileImg" class="w-8 h-8 rounded-full" />
      <span id="profileName" class="font-medium"></span>
    </button>

    <!-- Dropdown -->
    <div id="profileMenu"
     class="hidden absolute right-0 mt-3 w-52 bg-white text-black rounded-xl shadow-xl overflow-hidden z-50">
    <!-- üîî Notifications (NEW) -->
  <button id="openNotifications"
          class="relative w-full text-left px-4 py-3 hover:bg-gray-100">
    üîî Notifications
    <span id="notifBadge"
          class="hidden absolute right-4 top-3 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">
      0
    </span>
  </button>
  
  <!-- Posts -->
  <a href="my-posts.html"
     class="block px-4 py-3 hover:bg-gray-100">
    üì¶ Posts
  </a>

  <!-- Messages -->
  <button id="openMessages"
          class="relative w-full text-left px-4 py-3 hover:bg-gray-100">
    üí¨ Messages
    <span id="msgBadge"
          class="hidden absolute right-4 top-3 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">
      0
    </span>
  </button>

  <!-- Queries -->
  <a href="queries.html"
     class="relative block px-4 py-3 hover:bg-gray-100">
    ‚ùì Queries
    <span id="queryBadge"
          class="hidden absolute right-4 top-3 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">
      0
    </span>
  </a>

  <!-- Logout -->
  <button id="logoutBtn"
          class="w-full text-left px-4 py-3 hover:bg-red-500 hover:text-white transition">
    üö™ Logout
  </button>
</div>
  </div>
</div>
  </div>
</nav>

<div class="h-20"></div>

  <!-- üéØ Hero Section -->
  <div class="text-center py-16 px-6">
    <h1 class="hero-title text-5xl md:text-6xl font-bold mb-6">
      üß† Campus. Click. Connect.
    </h1>
    <p class="text-gray-300 text-lg mb-8 max-w-2xl mx-auto">
      Discover, swap, and connect with fellow students. Your campus marketplace for everything you need.
    </p>
    <button id="startSwappingBtn" class="cta-button font-semibold px-8 py-4 rounded-full shadow-lg">
      Start Swapping
    </button>

    <div id="searchContainer" class="search-container" style="display: none; align-items: center; gap: 8px; margin-top: 15px;">
      <input type="text" id="searchBar" placeholder="Search items..." 
            style="padding: 8px; border-radius: 5px; border: 1px solid #ccc; flex: 1;
                    background-color: black; color: white;">
      <button id="searchBtn" style="padding: 8px 12px; background-color: #ff6b00; color: white; border: none; border-radius: 5px; cursor: pointer;">
        üîç
      </button>
    </div>
  </div>

  <!-- üìÇ Categories -->
  <div class="px-6 mb-8">
    <h2 class="text-2xl font-semibold text-white mb-4">Browse Categories</h2>
    <div class="flex gap-4 overflow-x-auto pb-2">
      <div class="category-chip flex-shrink-0 bg-white text-black px-6 py-3 rounded-full cursor-pointer" data-category="all">All Items</div>
      <div class="category-chip flex-shrink-0 bg-white text-black px-6 py-3 rounded-full cursor-pointer" data-category="books">Books</div>
      <div class="category-chip flex-shrink-0 bg-white text-black px-6 py-3 rounded-full cursor-pointer" data-category="gadgets">Gadgets</div>
      <div class="category-chip flex-shrink-0 bg-white text-black px-6 py-3 rounded-full cursor-pointer" data-category="essentials">Essentials</div>
      <div class="category-chip flex-shrink-0 bg-white text-black px-6 py-3 rounded-full cursor-pointer" data-category="sports">Sports</div>
    </div>
  </div>

  <!-- üõí Featured Items -->
<div class="px-6 mb-12">
  <h2 class="text-2xl font-semibold text-white mb-6">Featured Items</h2>
  <div id="featured-items" class="flex gap-6 overflow-x-auto pb-4">
    <div class="item-card w-72 bg-white text-black rounded-2xl shadow-lg p-6" data-category="books" data-name="Books">
      <div class="w-full h-48 bg-gray-200 rounded-xl mb-4 flex items-center justify-center"><span class="text-6xl">üìö</span></div>
      <h3 class="font-semibold">Calculus Textbook</h3>
      <p class="text-sm mb-4">Latest edition, like new. Great for exams.</p>
      <div class="flex gap-2"><button class="flex-1 bg-black text-white py-2 rounded-lg" onclick="openModal(1)">View</button><button class="flex-1 border border-black text-black py-2 rounded-lg" onclick="openChat('Calculus Textbook', 'John Doe')">Message</button></div>
    </div>
    <div class="item-card w-72 bg-white text-black rounded-2xl shadow-lg p-6" data-category="gadgets" data-name="Bluetooth Headphones">
      <div class="w-full h-48 bg-gray-200 rounded-xl mb-4 flex items-center justify-center"><span class="text-6xl">üéß</span></div>
      <h3 class="font-semibold">Bluetooth Headphones</h3>
      <p class="text-sm mb-4">Noise-cancelling, battery 30hr. Barely used.</p>
      <div class="flex gap-2"><button class="flex-1 bg-black text-white py-2 rounded-lg" onclick="openModal(2)">View</button><button class="flex-1 border border-black text-black py-2 rounded-lg" onclick="openChat('Bluetooth Headphones', 'Jane Smith')">Message</button></div>
    </div>
    <div class="item-card w-72 bg-white text-black rounded-2xl shadow-lg p-6" data-category="essentials" data-name="Iron box">
      <div class="w-full h-48 bg-gray-200 rounded-xl mb-4 flex items-center justify-center"><span class="text-6xl">üñ®</span></div>
      <h3 class="font-semibold">Iron Box</h3>
      <p class="text-sm mb-4">Lightweight and quick heating. Almost new.</p>
      <div class="flex gap-2"><button class="flex-1 bg-black text-white py-2 rounded-lg" onclick="openModal(3)">View</button><button class="flex-1 border border-black text-black py-2 rounded-lg" onclick="openChat('Iron Box', 'Amit Sharma')">Message</button></div>
    </div>
    <div class="item-card w-72 bg-white text-black rounded-2xl shadow-lg p-6" data-category="gadgets" data-name="Laptop">
      <div class="w-full h-48 bg-gray-200 rounded-xl mb-4 flex items-center justify-center"><span class="text-6xl">üíª</span></div>
      <h3 class="font-semibold">HP Laptop</h3>
      <p class="text-sm mb-4">i5, 8GB RAM, 512GB SSD. Perfect condition.</p>
      <div class="flex gap-2"><button class="flex-1 bg-black text-white py-2 rounded-lg" onclick="openModal(4)">View</button><button class="flex-1 border border-black text-black py-2 rounded-lg" onclick="openChat('HP Laptop', 'Rohit Verma')">Message</button></div>
    </div>
    <div class="item-card w-72 bg-white text-black rounded-2xl shadow-lg p-6" data-category="gadgets" data-name="Powerbank">
      <div class="w-full h-48 bg-gray-200 rounded-xl mb-4 flex items-center justify-center"><span class="text-6xl">üîã</span></div>
      <h3 class="font-semibold">MI Power Bank</h3>
      <p class="text-sm mb-4">20000mAh, fast charging.</p>
      <div class="flex gap-2"><button class="flex-1 bg-black text-white py-2 rounded-lg" onclick="openModal(5)">View</button><button class="flex-1 border border-black text-black py-2 rounded-lg" onclick="openChat('MI Power Bank', 'Sneha Kapoor')">Message</button></div>
    </div>
    <div class="item-card w-72 bg-white text-black rounded-2xl shadow-lg p-6" data-category="essentials"data-name="Calculator">
      <div class="w-full h-48 bg-gray-200 rounded-xl mb-4 flex items-center justify-center"><span class="text-6xl">üßÆ</span></div>
      <h3 class="font-semibold">Calculator</h3>
      <p class="text-sm mb-4">Casio scientific calculator. Perfect for exams.</p>
      <div class="flex gap-2"><button class="flex-1 bg-black text-white py-2 rounded-lg" onclick="openModal(6)">View</button><button class="flex-1 border border-black text-black py-2 rounded-lg" onclick="openChat('Calculator', 'Karan Mehta')">Message</button></div>
    </div>
  </div>
</div>

<!-- Floating Buttons -->
<div class="fixed bottom-24 right-6 z-40 group transition-all duration-300 hover:scale-110">
  <button id="postBtn" class="relative flex items-center gap-2">
    <span class="opacity-0 group-hover:opacity-100 transition-opacity bg-black text-white text-xs rounded px-2 py-1">POST</span>
    <div class="flex items-center justify-center w-16 h-16 rounded-full shadow-lg bg-gradient-to-r from-yellow-400 to-yellow-200 text-black">
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
    </div>
  </button>
</div>

<div class="fixed bottom-6 right-6 z-40 group transition-all duration-300 hover:scale-110">
  <button id="floatingChatBtn" class="relative flex items-center gap-2">
    <span class="opacity-0 group-hover:opacity-100 transition-opacity bg-black text-white text-xs rounded px-2 py-1">CHAT</span>
    <div class="flex items-center justify-center w-14 h-14 rounded-full shadow-lg bg-gradient-to-r from-yellow-400 to-yellow-200 text-black border border-white">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
    </div>
  </button>
</div>

<div class="h-20"></div>

<!-- üìå Item Details Modal -->
<div id="itemModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="bg-white text-gray-900 rounded-2xl shadow-2xl w-full max-w-2xl p-8 relative animate-fadeIn border border-gray-200 my-10 max-h-[90vh] overflow-y-auto">

    <!-- Close Button -->
    <button onclick="closeModal()" class="absolute top-5 right-5 text-3xl font-bold text-gray-500 hover:text-red-500 transition">&times;</button>

    <!-- Carousel -->
    <div id="modalCarousel" class="relative w-full h-72 mb-6 overflow-hidden rounded-xl shadow-md">
      <div id="carouselImages" class="flex transition-transform duration-500"></div>
      <button id="prevImage" class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-black/50 hover:bg-black p-3 rounded-full text-white shadow-md transition">&#10094;</button>
      <button id="nextImage" class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-black/50 hover:bg-black p-3 rounded-full text-white shadow-md transition">&#10095;</button>
    </div>

    <!-- Item Details -->
    <h2 id="modalItemName" class="text-3xl font-extrabold mb-3 text-gray-800 tracking-wide border-b pb-2 border-gray-200">Item Name</h2>
    
    <div class="grid grid-cols-2 gap-4 text-lg">
      <p><span class="font-semibold text-gray-700">‚öô Specs:</span> <span id="modalItemSpecs" class="text-gray-600"></span></p>
      <p><span class="font-semibold text-gray-700">üì¶ Condition:</span> <span id="modalItemCondition" class="text-gray-600"></span></p>
      <p><span class="font-semibold text-gray-700">üîñ Model & Year:</span> <span id="modalItemModel" class="text-gray-600"></span></p>
      <p class="col-span-2"><span class="font-semibold text-gray-700">üìù Description:</span> <span id="modalItemDescription" class="text-gray-600"></span></p>
    </div>

    <!-- Seller Info -->
    <div class="mt-6 p-5 bg-gradient-to-r from-yellow-50 to-yellow-100 border border-yellow-300 rounded-xl shadow-inner">
      <h3 class="font-bold text-xl text-yellow-800 mb-3">üë§ Seller Information</h3>
      <div class="grid grid-cols-2 gap-4">
        <p><span class="font-semibold text-gray-800">Name:</span> <span id="modalItemSeller" class="text-gray-700"></span></p>
        <p><span class="font-semibold text-gray-800">Contact:</span> <span id="modalItemContact" class="text-gray-700"></span></p>
        <p class="col-span-2"><span class="font-semibold text-gray-800">üìç Location:</span> <span id="modalItemLocation" class="text-gray-700"></span></p>
      </div>
    </div>
  </div>
</div>

<!-- Hidden Post Item Form -->
<!-- Instagram-style Post Item Modal -->
<div id="postForm"
     class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center">

  <div class="bg-white text-black rounded-2xl shadow-2xl
              w-full max-w-4xl h-[560px] flex overflow-hidden">

    <!-- LEFT : IMAGE -->
    <div class="w-1/2 border-r bg-gray-50 flex items-center justify-center relative">

      <input id="itemImage" type="file" accept="image/*" class="hidden">

      <label for="itemImage"
             class="flex flex-col items-center justify-center cursor-pointer
                    text-gray-500 hover:text-black transition">
        <div class="w-32 h-32 border-2 border-dashed rounded-xl
                    flex items-center justify-center mb-4 text-3xl">
          üì∑
        </div>
        <p class="font-medium">Upload Item Image</p>
        <p class="text-xs text-gray-400">PNG / JPG</p>
      </label>

      <img id="imagePreview"
           class="hidden absolute inset-0 w-full h-full object-cover" />
    </div>

    <!-- RIGHT : FORM -->
    <div class="w-1/2 flex flex-col">

      <!-- Header -->
      <div class="flex justify-between items-center px-6 py-4 border-b">
        <h2 class="font-bold text-lg">Post an Item</h2>
        <button id="closePostForm"
                class="text-xl text-gray-500 hover:text-black">&times;</button>
      </div>

      <!-- Body -->
      <div class="flex-1 overflow-y-auto px-6 py-4 space-y-3">

        <input id="itemName" placeholder="Item Name" class="input" />
        <input id="itemPrice" placeholder="Price (‚Çπ)" type="number" class="input" />
       <input id="itemSpecs" placeholder="Specifications" class="input" />

        <div class="flex gap-2">
          <input id="itemCondition" placeholder="Condition" class="input w-1/2" />
          <input id="itemYear" placeholder="Year" class="input w-1/2" />
        </div>

        <input id="itemModel" placeholder="Model" class="input" />
        <textarea id="itemDescription" placeholder="Description"
                  class="input h-20 resize-none"></textarea>

        <input id="itemLocation" placeholder="Location" class="input" />
        <input id="itemContact" placeholder="Contact Info" class="input" />

      </div>

      <!-- Footer -->
      <div class="flex justify-end gap-3 px-6 py-4 border-t">
        <button id="closePostForm2"
                class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">
          Cancel
        </button>
        <button id="submitPost"
                class="px-6 py-2 rounded-lg bg-yellow-400 hover:bg-yellow-500 font-semibold">
          üöÄ Post
        </button>
      </div>

    </div>
  </div>
</div>

<style>
  .input {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    outline: none;
  }
  .input:focus {
    ring: 2px solid #facc15;
  }
</style>


<!-- Small animation -->
<style>
@keyframes fadeIn {
  from {opacity: 0; transform: scale(0.95);}
  to {opacity: 1; transform: scale(1);}
}
.animate-fadeIn {
  animation: fadeIn 0.3s ease-in-out;
}
</style>
<!-- üí¨ Chat Modal -->
<div id="chatModal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center">
  <div class="bg-white text-black w-full max-w-md rounded-xl p-4 flex flex-col">

    <div class="flex justify-between items-center border-b pb-2">
      <h2 class="font-bold">Chat</h2>
      <button onclick="closeChat()" class="text-xl">&times;</button>
    </div>

    <div id="chatMessages" class="flex-1 overflow-y-auto my-3 space-y-2"></div>

    <div class="flex gap-2">
      <input id="chatInput" type="text" placeholder="Type a message..."
        class="flex-1 border rounded px-3 py-2">
      <button id="sendMsgBtn"
        class="bg-yellow-400 px-4 py-2 rounded font-semibold">
        Send
      </button>
    </div>

  </div>
</div>
<!-- üí¨ Chat List Panel -->
<div id="chatList"
     class="hidden fixed bottom-24 right-6 w-72 bg-white text-black rounded-xl shadow-xl z-50 overflow-hidden">

  <div class="bg-black text-white px-4 py-2 font-semibold">
    Your Chats
  </div>

  <div id="chatListItems" class="max-h-80 overflow-y-auto">
    <!-- chats will load here -->
  </div>
</div>


<script>
  const imageInput = document.getElementById("itemImage");
const imagePreview = document.getElementById("imagePreview");
if (imageInput) {
  imageInput.addEventListener("change", () => {
    const file = imageInput.files[0];
    if (!file) return;
    imagePreview.src = URL.createObjectURL(file);
    imagePreview.classList.remove("hidden");
  });
}

  // Hide/Show Navbar
  let scrollTimeout;
  const navbar = document.getElementById("navbar");
  function hideNavbar() { if (window.scrollY > 0) { navbar.style.transform = "translateY(-100%)"; } }
  function showNavbar() { navbar.style.transform = "translateY(0)"; }
  window.addEventListener("scroll", () => {
    clearTimeout(scrollTimeout);
    if (window.scrollY <= 0) {
      showNavbar();
    } else {
      showNavbar();
      scrollTimeout = setTimeout(() => { hideNavbar(); }, 1500);
    }
  });

  // Category Filtering + Scroll
  const categoryButtons = document.querySelectorAll(".category-chip");
  const itemCards = document.querySelectorAll(".item-card");
  const featuredItems = document.getElementById("featured-items");

  categoryButtons.forEach(button => {
    button.addEventListener("click", () => {
      const category = button.getAttribute("data-category");
      itemCards.forEach(card => {
        if (category === "all" || card.getAttribute("data-category") === category) {
          card.style.display = "block";
        } else {
          card.style.display = "none";
        }
      });
      if (category === "all") {
        featuredItems.scrollTo({ left: 0, behavior: "smooth" });
      }
    });
  });

  // Limit to 5 items visible in All Items (scroll horizontally for more)
  featuredItems.style.overflowX = "auto";
  featuredItems.style.scrollBehavior = "smooth";
  featuredItems.style.whiteSpace = "nowrap";
  itemCards.forEach(card => { card.style.flex = "0 0 auto"; });

  // üóÇÔ∏è Item Database
  const items = {
    1: {
      name: "Calculus Textbook",
      specs: "Thomas' Calculus, 15th Edition, Pearson Publication, Hardcover, 1200 pages, includes access code for online resources",
      condition: "Like new ‚Äì No markings, no folded pages, stored in a smoke-free environment",
      model: "ISBN-13: 978-0134438986",
      year: "2023",
      seller: "John Doe",
      contact: "john.doe@studentmail.edu",
      phone: "+91 9876543210",
      location: "Block A, Hostel 3, ABC Engineering College",
      price: "‚Çπ1,500",
      description: "Perfect for engineering students. Covers single-variable and multivariable calculus with plenty of solved examples and practice problems. Bought for one semester, barely used.",
      images: [
  "https://via.placeholder.com/600x400?text=Item+Image"
   ]
    },
    2: {
      name: "Bluetooth Headphones",
      specs: "Bose QuietComfort 45, Bluetooth 5.1, Noise-Cancelling, 30-hour battery life, USB-C fast charging, lightweight design",
      condition: "Barely used ‚Äì Purchased in March 2023, used less than 10 times, no scratches or damage",
      model: "Bose QC45",
      year: "2022",
      seller: "Jane Smith",
      contact: "jane.smith@studentmail.edu",
      phone: "+91 9123456780",
      location: "Room 204, Girls Hostel, ABC Engineering College",
      price: "‚Çπ18,000",
      description: "Premium noise-cancelling headphones with crystal-clear audio and deep bass. Ideal for online classes, music lovers, and gaming. Comes with original box, charging cable, and carrying case.",
      images: [
        "bose_qc45_front.jpg",
        "bose_qc45_side.jpg",
        "bose_qc45_case.jpg",
        "bose_qc45_accessories.jpg"
      ]
    },
    3: {
      name: "Iron Box",
      specs: "Lightweight, quick heating, non-stick soleplate, adjustable temperature control, overheat protection",
      condition: "Almost new ‚Äì purchased 3 months ago, used only a few times",
      model: "Philips GC181/80",
      year: "2024",
      seller: "Amit Sharma",
      contact: "amit.sharma@studentmail.edu",
      phone: "+91 9876123456",
      location: "Block B, Room 102, Boys Hostel, XYZ University",
      price: "‚Çπ900",
      description: "Compact and energy-efficient dry iron, perfect for hostel use. Heats up quickly and provides smooth ironing without sticking to clothes.",
      images: [
        "IBLHI9108_1.jpg",
        "ironbox_side.jpg",
        "ironbox_bottom.jpg"
      ]
    },
    4: {
      name: "HP Laptop",
      specs: "Intel Core i5 (11th Gen), 8GB DDR4 RAM, 512GB SSD, 15.6-inch FHD display, Windows 11 Home, Backlit keyboard",
      condition: "Perfect condition ‚Äì no scratches, battery backup up to 7 hours",
      model: "HP 15s-fq2717TU",
      year: "2023",
      seller: "Rohit Verma",
      contact: "rohit.verma@studentmail.edu",
      phone: "+91 9123456789",
      location: "Room 210, Boys Hostel, XYZ University",
      price: "‚Çπ45,000",
      description: "A reliable laptop for both academic and personal use. Boots quickly, runs smoothly, and comes with genuine Windows and MS Office.",
      images: [
        "hp_laptop_front.jpg",
        "hp_laptop_keyboard.jpg",
        "hp_laptop_side.jpg"
      ]
    },
    5: {
      name: "MI Power Bank",
      specs: "20000mAh capacity, 18W fast charging, dual USB output, USB-C input/output, LED battery indicator",
      condition: "Like new ‚Äì used twice, no scratches",
      model: "Mi Power Bank 3i",
      year: "2024",
      seller: "Sneha Kapoor",
      contact: "sneha.kapoor@studentmail.edu",
      phone: "+91 9876012345",
      location: "Room 304, Girls Hostel, XYZ University",
      price: "‚Çπ1,500",
      description: "Keep your devices charged on the go. Supports multiple devices and can charge a phone up to 5 times on a single charge.",
      images: [
        "mi_powerbank_front.jpg",
        "mi_powerbank_ports.jpg",
        "mi_powerbank_box.jpg"
      ]
    },
    6: {
      name: "Calculator",
      specs: "Casio FX-991EX Scientific Calculator, 552 functions, natural textbook display, solar + battery power",
      condition: "Perfect condition ‚Äì no scratches, works flawlessly",
      model: "Casio FX-991EX",
      year: "2023",
      seller: "Karan Mehta",
      contact: "karan.mehta@studentmail.edu",
      phone: "+91 9876234501",
      location: "Block C, Room 105, Boys Hostel, XYZ University",
      price: "‚Çπ900",
      description: "Ideal for engineering and science students. Handles complex calculations including integration, matrices, and statistical analysis.",
      images: [
        "casio_calc_front.jpg",
        "casio_calc_keys.jpg",
        "casio_calc_box.jpg"
      ]
    }
  };

  let currentImageIndex = 0;
  let currentImages = [];

  // Open Modal
  function openModal(id) {
    const item = items[id];
    if (item) {
      document.getElementById("modalItemName").textContent = item.name;
      document.getElementById("modalItemSpecs").textContent = item.specs;
      document.getElementById("modalItemCondition").textContent = item.condition;
      document.getElementById("modalItemModel").textContent = `${item.model} (${item.year})`;
      document.getElementById("modalItemDescription").textContent = item.description;
      document.getElementById("modalItemSeller").textContent = item.seller;
      document.getElementById("modalItemContact").textContent = item.contact;
      document.getElementById("modalItemLocation").textContent = item.location;


      // Setup Carousel
      const carousel = document.getElementById("carouselImages");
      carousel.innerHTML = "";
      currentImages = item.images;
      currentImages.forEach(src => {
        const img = document.createElement("img");
        img.src = src;
        img.className = "w-full h-64 object-cover flex-shrink-0";
        carousel.appendChild(img);
      });
      currentImageIndex = 0;
      updateCarousel();

      document.getElementById("itemModal").classList.remove("hidden");
      document.getElementById("itemModal").classList.add("flex");
    }
  }

  // Close Modal
  function closeModal() {
    document.getElementById("itemModal").classList.add("hidden");
    document.getElementById("itemModal").classList.remove("flex");
  }

  // Carousel Navigation
  document.getElementById("prevImage").addEventListener("click", () => {
    currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
    updateCarousel();
  });
  document.getElementById("nextImage").addEventListener("click", () => {
    currentImageIndex = (currentImageIndex + 1) % currentImages.length;
    updateCarousel();
  });

  function updateCarousel() {
    const carousel = document.getElementById("carouselImages");
    carousel.style.transform = `translateX(-${currentImageIndex * 100}%)`;
  }

  
  // Toggle search bar when Start Swapping is clicked
  document.getElementById("startSwappingBtn").addEventListener("click", function() {
    const searchContainer = document.getElementById("searchContainer");
    
    if (searchContainer.style.display === "none" || searchContainer.style.display === "") {
      searchContainer.style.display = "flex"; // Show
    } else {
      searchContainer.style.display = "none"; // Hide
    }
  });
  // Function to filter items
  function searchItems() {
    let query = document.getElementById("searchBar").value.toLowerCase().trim();
    let items = document.querySelectorAll(".item-card"); // Replace with your actual item class

    items.forEach(function(item) {
      let name = item.getAttribute("data-name").toLowerCase();
      if (name.includes(query)) {
        item.style.display = "block";
      } else {
        item.style.display = "none";
      }
    });
  }

  // Search when clicking the button
  document.getElementById("searchBtn").addEventListener("click", searchItems);

  // Search when pressing Enter
  document.getElementById("searchBar").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      searchItems();
    }
  });
</script>
<script type="module">
const CLOUDINARY_CLOUD_NAME = "drtxs1jow";
const CLOUDINARY_UPLOAD_PRESET = "campus_trade_posts";
async function uploadImageToCloudinary(file) {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);

  const response = await fetch(
    `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,
    {
      method: "POST",
      body: formData
    }
  );

  const data = await response.json();

  if (!data.secure_url) {
    throw new Error("Image upload failed");
  }

  return data.secure_url;
}
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged, 
  signOut
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import {
  getFirestore,
  collection,
  addDoc,
  query,
  orderBy,
  onSnapshot,
  serverTimestamp,
  doc,
  setDoc,
  updateDoc,
  where
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
/* üî• Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyDWhJpHltwnlLQaaI17nfMjg8HEzbqC974",
  authDomain: "campus-trade-905da.firebaseapp.com",
  projectId: "campus-trade-905da",
  storageBucket: "campus-trade-905da.firebasestorage.app",
  messagingSenderId: "298965742852",
  appId: "1:298965742852:web:3158a48f9c8a9061538c51"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const submitPost = document.getElementById("submitPost");

submitPost.addEventListener("click", async () => {
  if (!auth.currentUser) {
    showMessage("Please login first", "error");
    return;
  }

  const title = itemName.value.trim();
  const price = itemPrice.value.trim();

  if (!title || !price) {
    showMessage("Item name & price are required", "error");
    return;
  }

  try {
    const fileInput = document.getElementById("itemImage");
    const file = fileInput.files[0];

    if (!file) {
      showMessage("Please select an image", "error");
      return;
    }

    // üî• CLOUDINARY UPLOAD (MANDATORY)
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", "campus_trade_posts");

    const res = await fetch(
      "https://api.cloudinary.com/v1_1/drtxs1jow/image/upload",
      {
        method: "POST",
        body: formData
      }
    );

    const data = await res.json();

    if (!data.secure_url) {
      throw new Error("Cloudinary upload failed");
    }

    const imageUrl = data.secure_url;

    // üî• SAVE TO FIRESTORE
    await addDoc(collection(db, "posts"), {
      title,
      price: Number(price),
      specs: itemSpecs.value,
      condition: itemCondition.value,
      model: itemModel.value,
      year: itemYear.value,
      description: itemDescription.value,
      location: itemLocation.value,
      contact: itemContact.value,
      ownerId: auth.currentUser.uid,
      ownerName: auth.currentUser.displayName,
      available: true,
      image: imageUrl, // ‚úÖ REAL URL ONLY
      createdAt: serverTimestamp()
    });

    showMessage("Item posted successfully üéâ", "success");

    postForm.classList.add("hidden");
    fileInput.value = "";
    imagePreview.classList.add("hidden");
    imagePreview.src = "";

  } catch (err) {
    console.error(err);
    showMessage("Failed to post item", "error");
  }
});



const postBtn = document.getElementById("postBtn");
const postForm = document.getElementById("postForm");
const closePostForm2 = document.getElementById("closePostForm2");

closePostForm2.addEventListener("click", () => {
  postForm.classList.add("hidden");
});

const authBtn = document.getElementById("authBtn");
/* üë§ PROFILE ELEMENTS */
const profileSection = document.getElementById("profileSection");
const profileBtn = document.getElementById("profileBtn");
const profileMenu = document.getElementById("profileMenu");
const profileImg = document.getElementById("profileImg");
const profileName = document.getElementById("profileName");
const logoutBtn = document.getElementById("logoutBtn");

/* üîê AUTH GUARD + PROFILE LOAD */
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login11.html";
    return;
  }
  profileImg.src = user.photoURL || "https://ui-avatars.com/api/?name=User";
  profileName.textContent = user.displayName || "User";
  // Show profile, hide auth button
  profileSection.classList.remove("hidden");
  authBtn.classList.add("hidden");

  // üî• CONNECT USER DOCUMENT
  const userRef = doc(db, "users", user.uid);

  onSnapshot(userRef, (snap) => {
    if (!snap.exists()) return;
    const data = snap.data();
    // Badges
    updateBadge("msgBadge", data.unreadMessagesCount);
    updateBadge("queryBadge", data.unreadQueriesCount);
  });
});

/* Dropdown toggle */
profileBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  profileMenu.classList.toggle("hidden");
});


/* Close dropdown on outside click */
document.addEventListener("click", (e) => {
  if (!profileSection.contains(e.target)) {
    profileMenu.classList.add("hidden");
  }
});

/* üö™ LOGOUT */
logoutBtn.addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "login11.html";
});

/* üí¨ OPEN MESSAGES */
document.getElementById("openMessages").addEventListener("click", () => {
  profileMenu.classList.add("hidden");
  document.getElementById("chatList").classList.remove("hidden");
});

/* üîë Expose globally */
window.auth = auth;
window.db = db;
let currentChatId = null;


/* üîò POST BUTTON PROTECTION */
postBtn.addEventListener("click", () => {
  if (!auth.currentUser) {
    showMessage("Please login to post items", "error");
    setTimeout(() => window.location.href = "login11.html", 1500);
    return;
  }

  postForm.classList.remove("hidden");
});

//getChatId
function getChatId(user1, user2, itemName) {
  return [user1, user2].sort().join("_") + "_" + itemName.replace(/\s+/g, "_");
}
//open chat
window.openChat = async function (itemName, sellerName) {
  if (!auth.currentUser) {
    showMessage("Please login to chat", "error");
    setTimeout(() => window.location.href = "login11.html", 1500);
    return;
  }

  const buyerId = auth.currentUser.uid;
  const sellerId = sellerName.replace(/\s+/g, "_"); // demo mapping
  currentChatId = getChatId(buyerId, sellerId, itemName);

  document.getElementById("chatModal").classList.remove("hidden");

  // Create chat doc if not exists
  await setDoc(
    doc(db, "chats", currentChatId),
    {
      users: [buyerId, sellerId],
      itemName: itemName,
      lastTimestamp: serverTimestamp()
    },
    { merge: true }
  );

  const msgBox = document.getElementById("chatMessages");

  onSnapshot(
    query(
      collection(db, "chats", currentChatId, "messages"),
      orderBy("timestamp")
    ),
    (snapshot) => {
      msgBox.innerHTML = "";
      snapshot.forEach(doc => {
        const m = doc.data();
        const bubble = document.createElement("div");
        bubble.className =
          m.senderId === auth.currentUser.uid
            ? "ml-auto bg-green-200 p-2 rounded-lg max-w-xs"
            : "bg-blue-200 p-2 rounded-lg max-w-xs";

        bubble.innerHTML = `
          <div class="text-xs font-semibold">${m.senderName}</div>
          <div>${m.text}</div>
        `;
        msgBox.appendChild(bubble);
      });
      msgBox.scrollTop = msgBox.scrollHeight;
    }
  );
};
/* üì© SEND MESSAGE */
document.getElementById("sendMsgBtn").addEventListener("click", async () => {
  const input = document.getElementById("chatInput");
  if (!input.value.trim()) return;

  await addDoc(
    collection(db, "chats", currentChatId, "messages"),
    {
      senderId: auth.currentUser.uid,
      senderName: auth.currentUser.displayName,
      text: input.value,
      timestamp: serverTimestamp(),
      read: false
    }
  );

  await updateDoc(doc(db, "chats", currentChatId), {
    lastMessage: input.value,
    lastTimestamp: serverTimestamp()
  });

  input.value = "";
});
/* ‚ùå CLOSE CHAT */
window.closeChat = function () {
  document.getElementById("chatModal").classList.add("hidden");
};
//FLOATING CHAT BUTTON
const floatingChatBtn = document.getElementById("floatingChatBtn");
const chatList = document.getElementById("chatList");
const chatListItems = document.getElementById("chatListItems");

floatingChatBtn.addEventListener("click", () => {
  if (!auth.currentUser) {
    showMessage("Please login to open chats", "error");
    return;
  }

  chatList.classList.toggle("hidden");

  onSnapshot(
    query(
      collection(db, "chats"),
      where("users", "array-contains", auth.currentUser.uid),
      orderBy("lastTimestamp", "desc")
    ),
    (snapshot) => {
      chatListItems.innerHTML = "";

      snapshot.forEach(docSnap => {
        const c = docSnap.data();
        const div = document.createElement("div");

        div.className = "p-3 border-b cursor-pointer hover:bg-gray-100";
        div.innerHTML = `
          <div class="font-semibold">${c.itemName}</div>
          <div class="text-xs text-gray-500">${c.lastMessage || ""}</div>
        `;

        div.onclick = () => openChat(c.itemName, c.users.find(u => u !== auth.currentUser.uid));
        chatListItems.appendChild(div);
      });
    }
  );
});
</script>
<script>
function showMessage(message, type) {
  const colors = {
    success: "bg-green-500",
    error: "bg-red-500",
    info: "bg-blue-500"
  };

  const msg = document.createElement("div");
  msg.className = `fixed top-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-lg text-white ${colors[type]} z-50`;
  msg.textContent = message;

  document.body.appendChild(msg);

  setTimeout(() => msg.remove(), 3000);
}
</script>
</body>
</html>
